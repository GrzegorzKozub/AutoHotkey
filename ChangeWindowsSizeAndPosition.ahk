; Settings

autofits1 := [ { Title: "Microsoft SQL Server Management Studio", Max: True }            
             , { Title: "Microsoft Visual Studio", Max: True } ]
            
autofits2 := [ { Title: " - EA" }
             , { Title: "Adobe Reader" }
             , { Title: "BareTail" }
             , { Title: "Beyond Compare" }
             , { Title: "Google Chrome" }
             , { Title: "JetBrains dotPeek" }
             , { Title: "LINQPad" }
             , { Title: "Microsoft Excel" }
             , { Title: "Microsoft FxCop" }
             , { Title: "Microsoft OneNote" }
             , { Title: "Microsoft Outlook" }
             , { Title: "Microsoft PowerPoint" }
             , { Title: "Microsoft Visio" }
             , { Title: "Microsoft Word" }
             , { Title: "Mozilla Firefox" }
             , { Title: "NUnit" }             
             , { Title: "Paint.NET" }
             , { Title: "SQL Server Profiler" }
             , { Title: "SumatraPDF" }
             , { Title: "Windows Internet Explorer" } ] 

updates1 := [ { Title: "Microsoft SQL Server Management Studio", Width: 1750, Height: 1000, Center: True }
            , { Title: "Microsoft Visual Studio", Width: 1750, Height: 1000, Center: True } ]

updates2 := [ { Title: "Adobe Reader", Width: 1500, Height: 1000, Center: True }
            , { Title: "BareTail", Width: 1500, Height: 1000, Center: True }
            , { Title: "Google Chrome", Width: 1500, Height: 1000, Center: True }
            , { Title: "JetBrains dotPeek", Width: 1500, Height: 1000, Center: True }            
            , { Title: "Kindle for PC", Width: 1500, Height: 1000, Center: True }
            , { Title: "LINQPad", Width: 1500, Height: 1000, Center: True }
            , { Title: "Microsoft Excel", Width: 1500, Height: 1000, Center: True }
            , { Title: "Microsoft FxCop", Width: 1500, Height: 1000, Center: True }
            , { Title: "Microsoft PowerPoint", Width: 1500, Height: 1000, Center: True }
            , { Title: "Microsoft Word", Width: 1500, Height: 1000, Center: True }
            , { Title: "Mozilla Firefox", Width: 1500, Height: 1000, Center: True }
            , { Title: "NUnit", Width: 1500, Height: 1000, Center: True }
            , { Title: "Paint.NET", Width: 1500, Height: 1000, Center: True }
            , { Title: "Picasa", Width: 1500, Height: 1000, Center: True } 
            , { Title: "SQL Server Profiler", Width: 1500, Height: 1000, Center: True } 
            , { Title: "SumatraPDF", Width: 1500, Height: 1000, Center: True }
            , { Title: "Windows Internet Explorer", Width: 1500, Height: 1000, Center: True } ]

updates3 := [ { Title: "iTunes", Width: 1200, Height: 850, Center: True }
            , { Title: "Origin", Width: 1200, Height: 850, Center: True }
            , { Title: "Steam", Width: 1200, Height: 850, Center: True } ]

updates4 := [ { Title: " - Appointment", Width: 925, Height: 800, Center: True } ; gkozub only            
            , { Title: " - Contact", Width: 925, Height: 800, Center: True } ; gkozub only            
            , { Title: " - Meeting", Width: 925, Height: 800, Center: True } ; gkozub only                         
            , { Title: " - Message", Width: 925, Height: 800, Center: True } ; gkozub only            
            , { Title: " - Task", Width: 925, Height: 800, Center: True } ] ; gkozub only                        
            
updates5 := [ { Title: "ActivClient", Width: 900, Height: 600, Center: True } ; gkozub only
            , { Title: "C:\Users\Grzegorz\", Width: 900, Height: 600, Center: True, Except: "Notepad" } ; 7-Zip
            , { Title: "InfraRecorder", Width: 900, Height: 600, Center: True }
            , { Title: "eMule", Width: 900, Height: 600, Center: True }
            , { Title: "Internet Information Services (IIS) Manager", Width: 900, Height: 600, Center: True, LoResMax: True } ; gkozub only
            , { Title: "KeePass Password Safe", Width: 900, Height: 600, Center: True }
            , { Title: "Notepad", Width: 900, Height: 600, Center: True, Except: "Notepad++" } ; also Notepad2
            , { Title: "Rapid Environment Editor", Width: 900, Height: 600, Center: True }
            , { Title: "Registry Editor", Width: 900, Height: 600, Center: True }
            , { Title: "Resource Hacker", Width: 900, Height: 600, Center: True }
            , { Title: "Sql Server Configuration Manager", Width: 900, Height: 600, Center: True } ; gkozub only
            , { Title: "VLC media player", Width: 900, Height: 600, Center: True }
            , { Title: "WinRAR", Width: 900, Height: 600, Center: True } 
            , { Title: "µTorrent", Width: 900, Height: 600, Center: True } ]

updates6 := [ { Title: "SyncBackPro", Width: 750, Height: 500, Center: True } 
            , { Title: "Windows Snapshot Maker", Width: 750, Height: 500, Center: True } ]
            
updates7 := [ { Title: " - Conversation", Width: 450, Height: 500, Center: True } ] ; gkozub only                                    

updates8 := [ { Title: "Apple QuickTime", Center: True }
            , { Title: "BRISS - BRight Snippet Sire", Center: True }
            , { Title: "C:\Windows\System32\cmd.exe", Center: True }
            , { Title: "Calculator", Center: True }
            , { Title: "Catalyst Control Center", Center: True }
            , { Title: "Client Automation Application Self-Service Manager", Center: True }
            , { Title: "Command Prompt", Center: True }
            , { Title: "DAEMON Tools Lite", Center: True }
            , { Title: "IrfanView", Center: True }            
            , { Title: "Konsola programu VirusScan", Center: True } ; gkozub only
            , { Title: "McAfee Host Intrusion Prevention", Center: True } ; gkozub only
            , { Title: "Microsoft Security Essentials", Center: True }
            , { Title: "Piriform Defraggler", Center: True }
            , { Title: "Shotty", Center: True }
            , { Title: "Stickies", Center: True }
            , { Title: "Web Platform Installer", Center: True } ]

updates9 := [ { Title: "Console", Left: 25, Top: 25 }
            , { Title: "foobar2000", Right: 25, Bottom: 25, Width: 900, Height: 830 }
            , { Title: "Friends", Right: 25, Bottom: 25, Width: 300, Height: 500 } ; Steam
            , { Title: "GVIM", Left: 25, Top: 25, Width: 1317, Height: 894, LoResHeight: 799, LoResMax: True } ; smaller on gkozub
            , { Title: "Miranda IM", Right: 25, Bottom: 25, Width: 300, Height: 500 } 
            , { Title: "Notepad++", Left: 25, Top: 25, Width: 1317, Height: 894, LoResHeight: 799, LoResMax: True } ; smaller on gkozub
            , { Title: "Office Communicator", Right: 25, Bottom: 25, Width: 300, Height: 500 } ; gkozub only
            , { Title: "Total Commander", Left: 25, Top: 25, Width: 1075, Height: 775 }
            , { Title: "Windows Task Manager", Right: 25, Bottom: 25, Width: 420, Height: 460 } 
            , { Title: "WinMerge", Left: 25, Top: 25, Width: 1317, Height: 894, LoResHeight: 799, LoResMax: True } ] ; smaller on gkozub
            
if (A_ComputerName == "ENVY") {
    _autofits := []
    _updates := [ updates1, updates2, updates3, updates5, updates6, updates8, updates9 ]
} else if (A_ComputerName == "GKOZUB") {
    _autofits := [ autofits1, autofits2 ]
    _updates := [ updates4, updates5, updates6, updates7, updates8, updates9 ]
} else {
    MsgBox Missing %A_ScriptName% settings for the %A_ComputerName% host name. The script will now exit.
    ExitApp
}

; Main

SetTitleMatchMode 2
HotKey #i, FixDesktopIcons
HotKey #w, FixWindows
HotKey #a, FixActiveWindow
HotKey #c, CenterActiveWindow
;OnMessage(0x219, "OnWmDeviceChange")
_screen := GetScreen()
return

; Labels

FixDesktopIcons:
    Run desktopcmd restore /y,, Hide
return

FixWindows:
    _screen := GetScreen()
    Act(_autofits, "AutofitWindow")
    Act(_updates, "UpdateWindow")
return

FixActiveWindow:
    _screen := GetScreen()
    WinGetActiveTitle title
    Act(_autofits, "AutofitWindow", title)
    Act(_updates, "UpdateWindow", title) 
return

CenterActiveWindow:
    _screen := GetScreen()
    WinGetActiveTitle title
    UpdateWindow({ Title: title, Center: True })
return

; Functions

OnWmDeviceChange(wParam, lParam, msg, hwnd) {
    Sleep 3000
    GoSub FixWindows
    GoSub FixDesktopIcons
}

Act(settings, action, title = "") {
    For key, value in settings {
        For key, value in value {
            if (!title || (InStr(title, value.Title) > 0 && (!value.Except || InStr(title, value.Except) == 0))) {
                %action%(value)
                if (title) {
                    match := True
                    break
                }
            }
        }
        if (match) {
            match := False
            break
        }
    } 
}

AutofitWindow(options) {
    global _screen
    if (!options.LoResMax) {
        options.LoResMax := True
    }
    if (!options.MarginWidth) {
        options.MarginWidth := 10
    }    
    if (!options.MarginHeight) {
        options.MarginHeight := 2
    }      
    if (!options.LoResMarginWidth) {
        options.LoResMarginWidth := 1
    }
    if (!options.LoResMarginHeight) {
        options.LoResMarginHeight := 1
    }        
    marginWidth := _screen.LoRes ? options.LoResMarginWidth : options.MarginWidth
    marginHeight := _screen.LoRes ? options.LoResMarginHeight : options.MarginHeight
    horizontalMargin := Round(_screen.Width * (marginWidth / 100))
    verticalMargin := Round(_screen.Height * (marginHeight / 100))
    options.Left := horizontalMargin
    options.Top := verticalMargin
    options.Width := _screen.Width - 2 * horizontalMargin
    options.Height := _screen.Height - 2 * verticalMargin
    UpdateWindow(options)
}

UpdateWindow(options) {
    global _screen
    window := GetWindowPositionAndSize(options.Title, options.Except)
    if (!window) {
        return
    }   
    left := options.Left ? options.Left : - options.Right
    top := options.Top ? options.Top : - options.Bottom
    width := (_screen.LoRes && options.LoResWidth) ? options.LoResWidth : options.Width
    height := (_screen.LoRes && options.LoResHeight) ? options.LoResHeight : options.Height
    maximize := _screen.LoRes ? options.LoResMax : options.Max
    SetWindowPositionAndSize(options.Title, options.Except, left, top, width, height, options.Center, maximize)
    if (window.Minimized) {
        WinMinimize % options.Title
    }
}

SetWindowPositionAndSize(title, except = "", left = "", top = "", width = "", height = "", center = False, maximize = False) {
    global _screen
    WinRestore %title%,, %except%
    window := GetWindowPositionAndSize(title, except)
    if (!width) {
        width := window.Width
    }  
    if (!height) {
        height := window.Height
    }     
    if (!left) {
        left := window.Left
    } else if (left < 0) {
        left := _screen.Width - (width + Abs(left))
    }
    if (!top) {
        top := window.Top
    } else if (top < 0) {
        top := _screen.Height - (height + Abs(top))
    }   
    WinMove %title%,, %left%, %top%, %width%, %height%, %except%
    if (center) {
        WinMove %title%,, (_screen.Width / 2) - (width / 2), (_screen.Height / 2) - (height / 2),,, %except%
    }
    if (maximize) {
        WinMaximize %title%,, %except%
    }
}

GetWindowPositionAndSize(title = "", except = "") {
    if (!title) {
        WinGetActiveTitle title
    }
    WinGetPos x, y, width, height, %title%,, %except%
    if (!x) {
        return
    }
    WinGet minMax, MinMax, %title%,, %except%
    return { Left: x, Top: y, Width: width, Height: height, Maximized: minMax == 1, Minimized: minMax == -1 }
}

GetScreen(monitor = "") {
    if (!monitor) {
        SysGet, monitor, MonitorPrimary
    }
    SysGet workArea, MonitorWorkArea, %monitor%
    return { Width: workAreaRight - workAreaLeft, Height: workAreaBottom - workAreaTop, LoRes: (workAreaRight - workAreaLeft) < 1600 }
}
